function keyPressEvent(){switch("Netscape"==navigator.appname?event.which:event.keyCode){case 13:CreateNewRow()}}function keyUpEvent(e){switch("Netscape"==navigator.appname?event.which:event.keyCode){case 38:case 40:setCaretPosition(e,caretPos,direction);break;default:editContent(e)}}function keyDownEvent(e){let t="Netscape"==navigator.appname?event.which:event.keyCode;switch(t){case 8:RowRemove(e);break;case 38:case 40:caretPos=getCaretPosition(e),direction=38===t?-1:1}}function CreateNewRow(){let e=document.getElementById("divEditContent"),t=document.getElementById("divPreview"),n=e.children.length+1,i=document.createElement("div");i.setAttribute("class","divEditRow"),i.addEventListener("paste",async e=>{e.preventDefault(),getClipboardContents(n-1)});let d=document.createElement("span");d.setAttribute("class","spEditNo"),d.innerHTML=n,i.appendChild(d);let o=document.createElement("div");o.setAttribute("class","divNewEdit"),o.setAttribute("contenteditable","true"),o.addEventListener("keyup",async()=>{keyUpEvent(o)}),o.addEventListener("keydown",async()=>{keyDownEvent(o)}),i.appendChild(o);let r=document.createElement("img");r.setAttribute("class","img-sizectrl"),r.setAttribute("src","maximise.png"),r.addEventListener("mousedown",async()=>{setEditDivMouseDown(o)}),i.appendChild(r),e.appendChild(i),t.innerHTML+='<div class="divNewPreview"></div>',e.children[e.children.length-1].children[1].focus()}var caretPos=0,direction=0;function getCaretPosition(e){let t,n;if(caretPos=0,window.getSelection)(t=window.getSelection()).rangeCount&&(n=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(caretPos=n.endOffset);else if(document.selection&&document.selection.createRange&&(n=document.selection.createRange()).parentElement()==e){var i=document.createElement("span");e.insertBefore(i,e.firstChild);var d=n.duplicate();d.moveToElementText(i),d.setEndPoint("EndToEnd",n),caretPos=d.text.length}return caretPos}function setCaretPosition(e,t,n){let i=parseInt(e.parentElement.children[0].innerHTML)-1+n;if(e.parentElement.parentElement.children[i]){let n=e.parentElement.parentElement.children[i],r=n.children[1].childNodes[0];if(r){r.focus;var d=document.createRange(),o=window.getSelection();d.setStart(r,r.length>t?t:r.length),d.collapse(!0),o.removeAllRanges(),o.addRange(d)}else n.children[1].focus()}}function editContent(e){let t=e.parentElement,n=parseInt(t.children[0].innerHTML),i=document.getElementById("divPreview"),d=i.children[n-1];d.innerHTML=e.innerHTML,i.scrollTo({top:d.offsetHeight*n-d.offsetHeight+(d.offsetHeight-d.clientHeight)*(n-1)/2,behavior:"smooth"}),13===("Netscape"==navigator.appname?event.which:event.keyCode)&&clearBrDiv()}function clearBrDiv(){let e=document.getElementById("divEditContent");for(i=0;i<e.children.length;i++){let t=e.children[i];t.children[1].children.length>1&&(t.children[1].innerHTML="")}}function RowRemove(e){if(""===e.innerHTML){let t=document.getElementById("divEditContent"),n=document.getElementById("divPreview");if(1===t.children.length)alert("can't remove the last row.");else{let d=e.parentElement,o=parseInt(d.children[0].innerHTML)-1;for(t.removeChild(d),n.removeChild(n.children[o]),i=0;i<t.children.length;i++)t.children[i].children[0].innerHTML=i+1;t.children[t.children[o]?o:o-1].children[1].focus()}}}async function getClipboardContents(e){try{for(var t=0;t<event.clipboardData.items.length;t++){var n=event.clipboardData.items[t];if(-1!=n.type.indexOf("image")){ConvertImgToBase64(await n.getAsFile()).then(t=>{post_to_imgur(e,"https://api.imgur.com/3/image",t)})}else if(-1!=n.type.indexOf("plain")){const t=await event.clipboardData.getData("Text");document.getElementById("divEditContent").children[e].children[1].innerHTML=t}}}catch(e){console.error(e,e.message)}}function getToken(){path=`https://api.imgur.com/oauth2/authorize?client_id=${$("#fun6_clientId").val()}&response_type=token&state=imgurUpdate`;window.open(path,"_blank")}function post_to_imgur(e,t,n){let i=$("#fun6_clientId").val();i&&""!==i?$.ajax({type:"POST",url:t,headers:{Authorization:"Client-ID "+i},mimeType:"multipart/form-data",data:{image:n.split(",")[1]},form:{image:n,type:"base64"},success:function(t){let n=document.getElementById("divEditContent").children[e].children[1],i=JSON.parse(t);n.innerHTML=i.data.link,editContent(n)},error:function(e){let t=JSON.parse(e.responseText);alert(t.data.error)}}):alert("Client ID can't be empty")}function ConvertImgToBase64(e){return new Promise((t,n)=>{let i=new FileReader;i.onload=(()=>{t(i.result)}),i.onerror=(()=>{n(i.error)}),i.readAsDataURL(e)})}function set_edit_div_with_id(){let e=parseInt($("#fun1_no").val())-1,t=$("#fun1_content").val(),n=document.getElementById("divEditContent");if(n.children[e]){let i=n.children[e].children[1];i.innerHTML=t,n.scrollTo({top:i.offsetHeight*e+(i.offsetHeight-i.clientHeight)*e,behavior:"smooth"}),editContent(i)}else alert("cant't find this row index")}function set_edit_div(){let e=$("#fun2_content").val(),t=document.getElementById("divEditContent");for(i=0;i<t.children.length;i++)t.children[i].children[1].innerHTML=e,editContent(t.children[i].children[1])}function set_preview_div(){let e=$("#fun3_content").val(),t=document.getElementById("divPreview");for(i=0;i<t.children.length;i++)t.children[i].innerHTML=e}function get_edit_div_content(){let e=parseInt($("#fun4_no").val())-1,t=document.getElementById("divEditContent");if(t.children[e]){let n=t.children[e].children[1];$("#fun4_content").html(n.innerHTML),$("#fun4_RtnArea").css("display","block"),t.scrollTo({top:n.offsetHeight*e+(n.offsetHeight-n.clientHeight)*e,behavior:"smooth"})}else alert("cant't find this row index")}function get_edit_div_all_content(){let e=document.getElementById("divEditContent"),t=[];for(i=0;i<e.children.length;i++)t.push(e.children[i].children[1].innerHTML);$("#fun5_content").html(JSON.stringify(t)),$("#fun5_RtnArea").css("display","block")}window.onload=function(){let e=document.getElementById("divEditContent");e.addEventListener("keypress",keyPressEvent),e.children[0].addEventListener("paste",async e=>{e.preventDefault(),getClipboardContents(0)}),e.children[0].children[1].addEventListener("keyup",async()=>{keyUpEvent(e.children[0].children[1])}),e.children[0].children[2].addEventListener("mousedown",async()=>{setEditDivMouseDown(e.children[0].children[1])}),e.children[0].children[1].addEventListener("keydown",async()=>{keyDownEvent(e.children[0].children[1])}),document.getElementById("btnFun1").addEventListener("click",async()=>{set_edit_div_with_id()}),document.getElementById("btnFun2").addEventListener("click",async()=>{set_edit_div()}),document.getElementById("btnFun3").addEventListener("click",async()=>{set_preview_div()}),document.getElementById("btnFun4").addEventListener("click",async()=>{get_edit_div_content()}),document.getElementById("btnFun5").addEventListener("click",async()=>{get_edit_div_all_content()})};var editIdx,src_posi_Y=0,dest_posi_Y=0,move_Y=0,is_mouse_down=!1,destHeight=30;function setEditDivMouseDown(e){let t=e.parentElement;editIdx=parseInt(t.children[0].innerHTML)-1,src_posi_Y=e.pageY,is_mouse_down=!0}$(function(){$(document).bind("click mouseup",function(e){is_mouse_down&&(is_mouse_down=!1)}).mousemove(function(e){if(is_mouse_down){dest_posi_Y=e.pageY,move_Y=src_posi_Y-dest_posi_Y,src_posi_Y=dest_posi_Y;let t=$(".divNewEdit",$("#divEditContent").children(".divEditRow")[editIdx]);destHeight=t.height()-move_Y,t.css("height",destHeight)}})});